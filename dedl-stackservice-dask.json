{"version":2,"kind":"Notebook","sha256":"ed016c3ef7ad32cbee08b86b136dccb53f4a4256d6e355dcb2f97bfa83e84e04","slug":"dedl-stackservice-dask","location":"/STACK/DEDL_StackService_Dask.ipynb","dependencies":[],"frontmatter":{"title":"DestinE Data Lake - Stack Service Dask","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"dedl","language":"python"},"numbering":{"title":{"offset":2}},"thumbnail":"/build/9aaf3e76d727ec891c8c02168fe0567d.jpeg","exports":[{"format":"ipynb","filename":"DEDL_StackService_Dask.ipynb","url":"/build/DEDL_StackService_Da-f05b059717c9e30bf827b924a1e95d1c.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"image","style":{"width":"100%","height":"250px","objectFit":"none","objectPosition":"0 75%"},"url":"/build/9aaf3e76d727ec891c8c02168fe0567d.jpeg","key":"CBjkpqG0Sl","urlSource":"https://www-cdn.eumetsat.int/files/styles/16_9_large/s3/2023-06/DestinationEarth-visual_colour-op_0.jpg?h=81e8e86e&itok=f4bdxtFA"},{"type":"heading","depth":1,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"DestinE Data Lake - Stack Service Dask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yRzngBySlA"}],"identifier":"destine-data-lake-stack-service-dask","label":"DestinE Data Lake - Stack Service Dask","html_id":"destine-data-lake-stack-service-dask","implicit":true,"key":"X2zp63ToDQ"}],"key":"wopyENAhEm"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Authentication via OIDC password grant flow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HYG0Dq1FIl"}],"identifier":"authentication-via-oidc-password-grant-flow","label":"Authentication via OIDC password grant flow","html_id":"authentication-via-oidc-password-grant-flow","implicit":true,"key":"O1fn8uynZ6"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The DEDL Stack client library holds the DaskOIDC class as a helper class to authenticate a user against the given identity provider of DestinE Data Lake.\nThe users password is directly handed over to the request object and is not stored.\nRefreshed token is used to request a new access token in case it is expired.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"U8ZtvCt58G"}],"key":"VH3ZBMZSvY"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The DaskMultiCluster class provides an abstraction layer to spawn multiple Dask clusters, one per location, within the data lake. Each cluster will be composed of 2 workers per default, with adaptive scaling enabled towards a maximum of 10 workers. In addition, the workers are configured to have 2 cores and 2 GB RAM per default. This can be changed via the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"MhgQcB3U76"},{"type":"link","url":"https://gateway.dask.org/cluster-options.html","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"cluster options","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"V4bx3k1iFy"}],"urlSource":"https://gateway.dask.org/cluster-options.html","key":"wI97Nl3L8f"},{"type":"text","value":" exposed up to the given service quota of the individual user role:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"wHa0EX8Y0l"}],"key":"T4Gav9qAT4"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Worker cores:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"eqpBPN2oRo"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"min: 1","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"qzU37QdB6f"}],"key":"X5VLylTzwY"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"max: ..::service-quota::..","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qbpCwtuIaL"}],"key":"tryMtuAQ2g"}],"key":"fzlyqiaEK5"}],"key":"yisrOr9Ks8"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Worker memory:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"lWaatyNqop"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"min: 1 GB","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ikwFWHMJvL"}],"key":"p67PHh7BDz"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"max: ..::service-quota::.. GB","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"IBAyQnmtMd"}],"key":"q3a8Z6WdR2"}],"key":"qa134rXHZI"}],"key":"risCez3woh"}],"key":"PrmiemIyoP"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Dask Worker and Scheduler nodes are based on a custom build ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"z5IUK6o2PF"},{"type":"link","url":"registry.eodc.eu/eodc/clusters/dedl-deployment/dedl-dask","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"container image","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"zDbWUp51EN"}],"urlSource":"registry.eodc.eu/eodc/clusters/dedl-deployment/dedl-dask","key":"muetGwJClA"},{"type":"text","value":" with the aim to match the environment, Jupyter Kernel, of the DEDL JupyterLab instance. Warnings will be displayed if a version missmatch is detected. Feel free to use your custom image to run your workloads by replacing the container image in the cluster options object.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"sl6U6592XQ"}],"key":"Cjzrq8O8Q7"}],"visibility":"show","key":"vN26BxQJk6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from dedl_stack_client.authn import DaskOIDC\nfrom dedl_stack_client.dask import DaskMultiCluster\nfrom rich.prompt import Prompt\n\nmyAuth = DaskOIDC(username=Prompt.ask(prompt=\"Username\"))\nmyDEDLClusters = DaskMultiCluster(auth=myAuth)\nmyDEDLClusters.new_cluster()","key":"XTplRHoQlB"},{"type":"output","id":"ZY4BcJbYAKWUnFxQOtM2E","data":[],"key":"bfENg7ICYX"}],"key":"Z68Zb2HfSQ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Print the given client object details per location as well as the link to the Dask dashboard.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q1whLGr5UI"}],"key":"eH8IqRCYic"}],"key":"Gl9EtjYmJH"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"with myDEDLClusters.as_current(location=\"central\") as myclient:\n    print(myclient)\n    print(myclient.dashboard_link)\nwith myDEDLClusters.as_current(location=\"lumi\") as myclient:\n    print(myclient)\n    print(myclient.dashboard_link)","visibility":"show","key":"pR2YvCZULX"},{"type":"output","id":"mUJY5g7KpGubbkXkJodJI","data":[],"visibility":"show","key":"r6EUg6ffqj"}],"visibility":"show","key":"mPujaUeFGI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Shutdown the all clusters and free up all resources","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aXSh0t9XVT"}],"identifier":"shutdown-the-all-clusters-and-free-up-all-resources","label":"Shutdown the all clusters and free up all resources","html_id":"shutdown-the-all-clusters-and-free-up-all-resources","implicit":true,"key":"MWHv0hakgI"}],"key":"FFlBqyOhI1"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"myDEDLClusters.shutdown()","visibility":"show","key":"iGkqzu1BI3"},{"type":"output","id":"xedX62DfixigZwX9l-daq","data":[],"visibility":"show","key":"LC8Q8tSQXh"}],"visibility":"show","key":"aOcJ6pMgRM"}],"key":"Gj2QOKYK1l"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Create a dashboard based on Data Cube populated with data obtained from Weather and Geophysical Extremes Digital Twin (DT) - ExtremeDT","url":"/extremedt-datacube-xviewer","group":"STACK"}}},"domain":"http://localhost:3001"}