{"version":2,"kind":"Notebook","sha256":"6ef01aab7e067a4c931ecf61b2cead89ee922382502b1bcedf45090363819146","slug":"extremedt-dataavailability","location":"/HDA/DestinE_Digital_Twins/ExtremeDT-dataAvailability.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"numbering":{"title":{"offset":2}},"thumbnail":"/build/b27bd30f978ddf0848f3ea0942070886.jpeg","exports":[{"format":"ipynb","filename":"ExtremeDT-dataAvailability.ipynb","url":"/build/ExtremeDT-dataAvaila-2d1d28179189b87bf1720d3e3f792eb9.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"image","url":"/build/b27bd30f978ddf0848f3ea0942070886.jpeg","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fEH9AoaeLJ","urlSource":"https://github.com/destination-earth/DestinE-DataLake-Lab/blob/main/img/DestinE-banner.jpg?raw=true"}],"visibility":"show","key":"VIVG9BT2vu"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"children":[{"type":"text","value":"Aviso notification for DT data availability","key":"I4eEXm3mv8"}],"identifier":"aviso-notification-for-dt-data-availability","label":"Aviso notification for DT data availability","html_id":"aviso-notification-for-dt-data-availability","implicit":true,"key":"vfPZ9vKowf"}],"key":"naPduG2zoW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Author","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QwbD9i1cpm"}],"key":"xIT7CmAXKI"},{"type":"text","value":": EUMETSAT ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ms6cLc7jiL"},{"type":"break","key":"cCgk7GDEbj"},{"type":"text","value":"\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ylSQysoYME"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Copyright","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z6l3ZvbvYb"}],"key":"abj2fFPv4V"},{"type":"text","value":": 2024 EUMETSAT ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NqGrFN2J8J"},{"type":"break","key":"MXyZaUWlgf"},{"type":"text","value":"\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xUsRCgzQUn"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Licence","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PZ0o4TXeEb"}],"key":"rtVEt7Oj9B"},{"type":"text","value":": MIT ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yoSYkje4hf"},{"type":"break","key":"pRZf8B2i92"}],"key":"XE79IbFHu0"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Credit","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YNZOeyEDFf"}],"key":"A69zqrR1YC"},{"type":"text","value":": The pyaviso package is provided by the European Centre for Medium-Range Weather Forecasts (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qkr8FXYQzF"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"ECMWF","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"isUv2LC8wH"}],"key":"MV7Jwy4ZrL"},{"type":"text","value":").","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zOKLAZE4lt"}],"key":"HgN9Ly7vyO"}],"key":"VaKD2NHj4h"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This notebook shows how to check the data availablility for the Weather-Induced Extremes Digital Twin (Extremes DT) using the ECMWF Aviso package.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"w3Fnx3YdE1"}],"key":"KTvsuHHZjO"}],"key":"J9q5k6uudL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"children":[{"type":"text","value":"Install the pyaviso package","key":"MOEWP76QIH"}],"identifier":"install-the-pyaviso-package","label":"Install the pyaviso package","html_id":"install-the-pyaviso-package","implicit":true,"key":"QofJ89pPgH"}],"key":"BuBFhO2jCA"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"!pip  install  pyaviso --quiet","visibility":"show","key":"gbUAzCkBI2"},{"type":"output","id":"237R6Fk5gROXRieJbTP60","data":[],"visibility":"show","key":"moMsJZY5gS"}],"visibility":"show","key":"NkiikoyrTU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"children":[{"type":"text","value":"Import pyaviso","key":"WYyCnUuovr"}],"identifier":"import-pyaviso","label":"Import pyaviso","html_id":"import-pyaviso","implicit":true,"key":"BQooIbA4qz"},{"type":"paragraph","children":[{"type":"text","value":"Import pyaviso and other useful libraries. Defining constants and functions.","key":"OscLx7D1rG"}],"key":"u5nIa6XZ5z"}],"key":"SQUxXZV45F"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from datetime import datetime\nfrom pprint import pprint as pp\n\nfrom pyaviso import NotificationManager, user_config","visibility":"show","key":"pEjOaJ9c39"},{"type":"output","id":"A8yLxplrb8IPyoxJajH_E","data":[],"visibility":"show","key":"ZHDweXK82S"}],"visibility":"show","key":"NwPf3klQ5d"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"LISTENER_EVENT = \"data\"  # Event for the listener, options are mars and dissemination\nTRIGGER_TYPE = \"function\"  # Type of trigger for the listener","visibility":"show","key":"zvnSd8jecX"},{"type":"output","id":"SyrQScSzrnAPhVP0jljYM","data":[],"visibility":"show","key":"vM2vj8OqeV"}],"visibility":"show","key":"ekssHApDcC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"children":[{"type":"text","value":"Defining the data to be notified","key":"dWhpLflOAV"}],"identifier":"defining-the-data-to-be-notified","label":"Defining the data to be notified","html_id":"defining-the-data-to-be-notified","implicit":true,"key":"JZPGy2Owwl"},{"type":"paragraph","children":[{"type":"text","value":"The following request describes the data whose availability we want to be notified","key":"sHzBVbFt0e"}],"key":"ZnGCCtAqbl"}],"key":"gYO0MmozaN"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"REQUEST = {\n    \"class\": \"d1\",\n#    \"dataset\": \"extremes-dt\",\n    \"expver\": \"0001\",\n    \"stream\": \"wave\",\n    \"type\": \"fc\",\n    \"time\": \"00\",\n    \"step\": \"0\",\n    \"levtype\": \"sfc\",\n#    \"levelist\": \"\",\n#    \"param\": \"168\"   \n}  # Request configuration for the listener\n","visibility":"show","key":"Oe797AiU8X"},{"type":"output","id":"n4Oc8UrxL-f-rWUJ4Gku-","data":[],"visibility":"show","key":"oNecEtmUkp"}],"visibility":"show","key":"d5kXL8wHsd"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"children":[{"type":"text","value":"Aviso configuration","key":"vlVK6idU4F"}],"identifier":"aviso-configuration","label":"Aviso configuration","html_id":"aviso-configuration","implicit":true,"key":"PhCnnCAscn"}],"key":"EFrZ2gDwAG"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"CONFIG = {\n    \"notification_engine\": {\n        \"host\": \"aviso.lumi.apps.dte.destination-earth.eu\",\n        \"port\": 443,\n        \"https\": True,\n    },\n    \"configuration_engine\": {\n        \"host\": \"aviso.lumi.apps.dte.destination-earth.eu\",\n        \"port\": 443,\n        \"https\": True,\n    },\n    \"schema_parser\": \"generic\",\n    \"remote_schema\": True,\n    \"auth_type\": \"none\",\n    \"quiet\" : True\n}  # manually defined configuration\n","visibility":"show","key":"GGyc57Mxv3"},{"type":"output","id":"HPaVkjoSMXiz6Iju45jA5","data":[],"visibility":"show","key":"AKJCmZkN1l"}],"visibility":"show","key":"OopVgC0nGe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"children":[{"type":"text","value":"Searching for old notifications","key":"lCnbT25SWZ"}],"identifier":"searching-for-old-notifications","label":"Searching for old notifications","html_id":"searching-for-old-notifications","implicit":true,"key":"LpvV2cspbX"},{"type":"paragraph","children":[{"type":"text","value":"Ssearching for old notifications where available. This way users can explicitly replay past notifications and executes triggers.","key":"BUYu920ECP"}],"key":"xK8lRzqzno"}],"key":"xvJeSTQJ2C"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import sys\nSTART_DATE = datetime(2020, 12, 12)  # Start date for the notification listener","visibility":"show","key":"Ki6adb0yS5"},{"type":"output","id":"0tdh5NtAChzkl28OpLanF","data":[],"visibility":"show","key":"Tv3rvbxvNl"}],"visibility":"show","key":"LnxDdgkcnC"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def triggered_function(notification):\n    \"\"\"\n    Function for the listener to trigger.\n    \"\"\"\n    \n    #pp(notification)\n    # Access the date field\n    date_str = notification['request']['date']    \n\n    # Convert the date string to a datetime object\n    date_obj = datetime.strptime(date_str, '%Y%m%d')\n    formatted_date = date_obj.strftime('%Y-%m-%d')\n    pp(\"ExtremeDT data available=>\" + formatted_date)\n    \n    ","visibility":"show","key":"B36I9oEiOE"},{"type":"output","id":"PWqXNkQzWdXsUZpdsVa4E","data":[],"visibility":"show","key":"LMQwdMyStE"}],"visibility":"show","key":"ZLoCTF9mYF"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def create_hist_listener():\n    \"\"\"\n    Creates and returns a listener configuration.\n    \"\"\"\n\n    trigger = {\n        \"type\": TRIGGER_TYPE,\n        \"function\": triggered_function,\n    }  # Define the trigger for the listener\n    \n    # Return the complete listener configuration\n    return {\"event\": LISTENER_EVENT, \"request\": REQUEST, \"triggers\": [trigger]}\n","visibility":"show","key":"PY0UVlSXKn"},{"type":"output","id":"lmYbZ_C8B2hPXfdsaLm8k","data":[],"visibility":"show","key":"V2aPdDUVGN"}],"visibility":"show","key":"HxDBRTQMli"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"try:\n    listener = create_hist_listener()  # Create listener configuration\n    listeners_config = {\"listeners\": [listener]}  # Define listeners configuration\n    config = user_config.UserConfig(**CONFIG)\n    print(\"loaded config:\")\n    pp(CONFIG)\n    nmh = NotificationManager()  # Initialize the NotificationManager\n\n    nmh.listen(\n        listeners=listeners_config, from_date=START_DATE, config=config\n    )  # Start listening\nexcept Exception as e:\n    print(f\"Failed to initialize the Notification Manager: {e}\")","visibility":"show","key":"I2NM0zhRrs"},{"type":"output","id":"gziJOu7z0oqTDQtWz-Bi3","data":[{"name":"stdout","output_type":"stream","text":"loaded config:\n{'auth_type': 'none',\n 'configuration_engine': {'host': 'aviso.lumi.apps.dte.destination-earth.eu',\n                          'https': True,\n                          'port': 443},\n 'notification_engine': {'host': 'aviso.lumi.apps.dte.destination-earth.eu',\n                         'https': True,\n                         'port': 443},\n 'quiet': True,\n 'remote_schema': True,\n 'schema_parser': 'generic'}\n'ExtremeDT data available=>2025-03-18'\n'ExtremeDT data available=>2025-03-17'\n'ExtremeDT data available=>2025-03-16'\n'ExtremeDT data available=>2025-03-15'\n'ExtremeDT data available=>2025-03-14'\n'ExtremeDT data available=>2025-03-13'\n'ExtremeDT data available=>2025-03-12'\n'ExtremeDT data available=>2025-03-11'\n'ExtremeDT data available=>2025-03-10'\n'ExtremeDT data available=>2025-03-09'\n'ExtremeDT data available=>2025-03-08'\n'ExtremeDT data available=>2025-03-07'\n'ExtremeDT data available=>2025-03-06'\n'ExtremeDT data available=>2025-03-05'\n'ExtremeDT data available=>2025-03-04'\n'ExtremeDT data available=>2025-03-03'\n'ExtremeDT data available=>2025-03-02'\n'ExtremeDT data available=>2025-03-01'\n'ExtremeDT data available=>2025-02-28'\n'ExtremeDT data available=>2025-02-27'\n'ExtremeDT data available=>2025-02-26'\n'ExtremeDT data available=>2025-02-25'\n'ExtremeDT data available=>2025-02-24'\n'ExtremeDT data available=>2025-02-23'\n'ExtremeDT data available=>2025-02-22'\n'ExtremeDT data available=>2025-02-21'\n'ExtremeDT data available=>2025-02-20'\n"}],"visibility":"show","key":"teP6zhN5sD"}],"visibility":"show","key":"fl7Xoq3xU7"}],"key":"j2VZB55C1r"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"HDA PySTAC-Client Introduction","url":"/hda-pystac-client","group":"HDA"},"next":{"title":"Destination Earth - Weather-Induced Extremes Digital Twin - Data Access using DEDL HDA","url":"/dedl-hda-eo-ecmwf-dat-dt-extremes","group":"HDA"}}},"domain":"http://localhost:3001"}